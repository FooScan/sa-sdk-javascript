(window.SensorsDataWebJSSDKPlugin=window.SensorsDataWebJSSDKPlugin||{}).GAForwardSensorsData=function(){"use strict";function t(t,e,r){if(e&&(t.plugin_name=e),r&&t.init){var o=t.init;t.init=function(i,a){function c(){o.call(t,i,a)}return n(i,t,e),i.readyState&&i.readyState.state>=3||!i.on?c():void i.on(r,c)}}return t}function n(t,n,e){function r(n,r){t.logger?t.logger.msg.apply(t.logger,r).module(e+""||"").level(n).log():t.log&&t.log.apply(t,r)}n.log=function(){r("log",arguments)},n.warn=function(){r("warn",arguments)},n.error=function(){r("error",arguments)}}function e(n,e,r){return t(n,e,r),n.plugin_version=u,n}function r(t,n){S?S.log(t,n):"object"==typeof console&&console.log&&console.log(t,n)}function o(t,n){var e="function"==typeof Symbol&&t[Symbol.iterator];if(!e)return t;var o,i=e.call(t),a=[];try{for(;(void 0===n||n-- >0)&&!(o=i.next()).done;)a.push(o.value)}finally{try{o&&!o.done&&(e=i["return"])&&e.call(i)}catch(c){r(c)}}return a}function i(t){var n="function"==typeof Symbol&&Symbol.iterator,e=n&&t[n],r=0;if(e)return e.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}function a(){return"function"!=typeof window.Proxy||"function"!=typeof window.URL||"function"!=typeof navigator.sendBeacon||"function"!=typeof window.Request?(r("current Browser is not support proxy API,cannot forward GA4 to SensorsAnalytics"),!1):(j.navigator.sendBeacon=new Proxy(j.navigator.sendBeacon,{apply:function(t,n,e){return D.apply(n,e),t.apply(n,e)}}),void(j.fetch=new Proxy(j.fetch,{apply:function(t,n,e){return R.apply(n,e),t.apply(n,e)}})))}function c(t){r("amp-event",t),t.forEach(function(t){t.user_properties&&Object.keys(t.user_properties).length>0&&S.setProfile(t.user_properties),t.login_id&&S.login(t.login_id),t.item.length>0&&t.item.forEach(function(t){"string"==typeof t.item_name&&"string"==typeof t.item_id&&S.setItem(t.item_name,t.item_id,t)}),S.track(t.event,t.properties||{})})}var u="1.26.15",l=["analytics.google.com","google-analytics.com"],s="/g/collect",f="2",p="v",g="uid",y="en",d="cid",m="ep.",v="epn.",h="up.",_="upn.",S=null,w=function(){return w=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++){n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},w.apply(this,arguments)},b=function(t){return t.searchParams.get(p)===f},x=function(t,n,e){var a,c={};try{for(var u=i(n.searchParams.entries()),l=u.next();!l.done;l=u.next()){var s=l.value,f=o(s,2),p=f[0],g=f[1];c[p]=g}}finally{try{l&&!l.done&&(a=u["return"])&&a.call(u)}catch(y){r(y)}}if(!e)return[c];var d;return"beacon"===t?d=e.toString().split("\\r\\"):"fetch"===t&&(d=e.toString().split("\r\n")),d=d.map(function(t){var n=w(w({},c),t.split("&").reduce(function(t,n){var e=o(n.split("="),2),r=e[0],i=e[1];return t[decodeURIComponent(r)]=decodeURIComponent(i),t},{}));return n})},P=function(t){function n(t){function n(t){var n={id:"item_id",nm:"item_name",br:"item_brand",ca:"item_category",c2:"item_category2",c3:"item_category3",c4:"item_category4",c5:"item_category5",va:"item_variant",pr:"price",qt:"quantity",cp:"coupon",ln:"item_list_name",lp:"index",li:"item_list_id",ds:"discount",af:"affiliation",pi:"promotion_id",pn:"promotion_name",cn:"creative_name",cs:"creative_slot",lo:"location_id"};return t in n?n[t]:t}var e=t.split("~"),r={};return e.length>0&&e.forEach(function(t,o){if("string"!=typeof t)return t;var i=t.match(/^[k](\d+)(.+)/);if(i&&i[1]&&i[2]&&"string"==typeof e[o+1]&&e[o+1].startsWith("v"+i[1]))r[t.slice(String(i[1]).length+1)]=e[o+1].slice(String(i[1]).length+1),e[o+1]=void 0;else{var a=t.slice(0,2),c=t.slice(2);"id"===a||"nm"===a?r[n(a)]=c.replace(/\s/g,"_"):r[n(a)]=c}return r}),r}return t.map(function(t){t.cu&&(t["ep.currency"]=t.cu);for(var e=1,r=[];t["pr"+e];)r.push(n(t["pr"+e])),++e;return{anonymous_id:String(t[d]),event:String(t[y]).replace(/\s/g,"_"),login_id:t[g],properties:w(w({},W(t,m,v))),user_properties:W(t,h,_),item:r}})},W=function(t,n,e){var a,c,u={};try{for(var l=i(Object.entries(t)),s=l.next();!s.done;s=l.next()){var f=s.value,p=o(f,2),g=p[0],y=p[1];g.startsWith(n)&&(c=g.slice(n.length),u[c]=String(y)),g.startsWith(e)&&(c=g.slice(e.length),u[c]=Number(y))}}finally{try{s&&!s.done&&(a=l["return"])&&a.call(l)}catch(d){r(d)}}return u},j=window,R=function(t,n){var e="";try{(null===j||void 0===j?void 0:j.Request)&&t instanceof j.Request?e=t.url:"string"==typeof t?e=t:"toString"in t&&"function"==typeof t.toString&&(e=t.toString())}catch(o){r(o)}O("fetch",e,"object"==typeof n?n.body:null)},D=function(t,n){return O("beacon",t,n)},O=function(t,n,e){if(n.startsWith("/")&&!n.startsWith("//"))return!1;try{var o=new URL(n);if(l.some(function(t){return o.hostname.endsWith(t)})&&o.pathname===s&&b(o)){var i=x(t,o,e);r("ga-event",i);var a=P(i);c(a)}}catch(u){r(u)}},q={plugin_name:"GAForwardSensorsData",init:function(t){S=t,a()}},A=e(q);return A}();