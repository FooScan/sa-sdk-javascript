function wrapPluginInitFn(t,e,i){var r=t.init;return e&&(t.name=e),t.init=function(e,s){if(e.readyState&&e.readyState.state>=3||!e.on)return n();function n(){r.call(t,e,s)}e.on(i,n)},t}var siteLinker={getPart:function(t){var e=this.option.length;if(e)for(var i=0;i<e;i++)if(t.indexOf(this.option[i].part_url)>-1)return!0;return!1},getPartHash:function(t){var e=this.option.length;if(e)for(var i=0;i<e;i++)if(t.indexOf(this.option[i].part_url)>-1)return this.option[i].after_hash;return!1},getCurrenId:function(){var t=this.store.getDistinctId()||"",e=this.store.getFirstId()||"";return this._.urlSafeBase64&&this._.urlSafeBase64.encode?t=t?this._.urlSafeBase64.trim(this._.urlSafeBase64.encode(this._.base64Encode(t))):"":this._.rot13obfs&&(t=t?this._.rot13obfs(t):""),encodeURIComponent(e?"f"+t:"d"+t)},rewriteUrl:function(t,e){var i=this,r=/([^?#]+)(\?[^#]*)?(#.*)?/.exec(t),s="";if(r){var n,a=r[1]||"",o=r[2]||"",h=r[3]||"",d="_sasdk="+this.getCurrenId(),u=function(t){var e=t.split("&"),r=[];return i._.each(e,function(t){t.indexOf("_sasdk=")>-1?r.push(d):r.push(t)}),r.join("&")};if(this.getPartHash(t))n=h.indexOf("_sasdk"),s=h.indexOf("?")>-1?n>-1?a+o+"#"+h.substring(1,n)+u(h.substring(n,h.length)):a+o+h+"&"+d:a+o+"#"+h.substring(1)+"?"+d;else n=o.indexOf("_sasdk"),s=/^\?(\w)+/.test(o)?n>-1?a+"?"+u(o.substring(1))+h:a+o+"&"+d+h:a+"?"+d+h;return e&&(e.href=s),s}},getUrlId:function(){var t=location.href.match(/_sasdk=([aufd][^\?\#\&\=]+)/);if(this._.isArray(t)&&t[1]){var e=decodeURIComponent(t[1]);return!e||"f"!==e.substring(0,1)&&"d"!==e.substring(0,1)||(this._.urlSafeBase64&&this._.urlSafeBase64.isUrlSafeBase64&&this._.urlSafeBase64.isUrlSafeBase64(e)?e=e.substring(0,1)+this._.base64Decode(this._.urlSafeBase64.decode(e.substring(1))):this._.rot13defs&&(e=e.substring(0,1)+this._.rot13defs(e.substring(1)))),e}return""},setRefferId:function(){var t=this.store.getDistinctId(),e=this.getUrlId();if(""===e)return!1;var i="a"===e.substring(0,1)||"d"===e.substring(0,1);if((e=e.substring(1))===t)return!1;e&&i&&this.store.getFirstId()&&(this.sd.identify(e,!0),this.sd.saEvent.send({original_id:e,distinct_id:t,type:"track_signup",event:"$SignUp",properties:{}},null)),e&&i&&!this.store.getFirstId()&&this.sd.identify(e,!0),!e||i||this.store.getFirstId()||this.sd.login(e)},addListen:function(){var t=this,e=function(e){var i,r,s=e.target,n=s.tagName.toLowerCase(),a=s.parentNode;if("a"===n&&s.href||a&&a.tagName&&"a"===a.tagName.toLowerCase()&&a.href){"a"===n&&s.href?(i=s.href,r=s):(i=a.href,r=a);var o=t._.URL(i).protocol;"http:"!==o&&"https:"!==o||t.getPart(i)&&t.rewriteUrl(i,r)}};t._.addEvent(document,"mousedown",e),window.PointerEvent&&"maxTouchPoints"in window.navigator&&window.navigator.maxTouchPoints>=0&&t._.addEvent(document,"pointerdown",e)},init:function(t,e){this.sd=t,this._=t._,this.store=t.store,this.para=t.para,this._.isObject(e)&&this._.isArray(e.linker)&&e.linker.length>0?(this.setRefferId(),this.addListen(),this.option=e.linker,this.option=function(e){for(var i=e.length,r=[],s=0;s<i;s++)/[A-Za-z0-9]+\./.test(e[s].part_url)&&"[object Boolean]"==Object.prototype.toString.call(e[s].after_hash)?r.push(e[s]):t.log("linker \u914d\u7f6e\u7684\u7b2c "+(s+1)+" \u9879\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u68c0\u67e5\u53c2\u6570\u683c\u5f0f\uff01");return r}(this.option)):t.log("\u8bf7\u914d\u7f6e\u6253\u901a\u57df\u540d\u53c2\u6570\uff01")}};wrapPluginInitFn(siteLinker,"SiteLinker","sdkReady");export default siteLinker;