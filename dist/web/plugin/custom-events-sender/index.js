(window.SensorsDataWebJSSDKPlugin=window.SensorsDataWebJSSDKPlugin||{}).CustomEventsSender=function(){"use strict";function n(n,e,t){if(e&&(n.plugin_name=e),t&&n.init){var a=n.init;n.init=function(e,r){function i(){a.call(n,e,r)}return e.readyState&&e.readyState.state>=3||!e.on?i():void e.on(t,i)}}return n}function e(e,t,a){return n(e,t,a),e.plugin_version=u,e}function t(n){var e=[];return o.each(n,function(n){o.isArray(n)?e=e.concat(t(n)):e.push(o.optimizeServerUrl(n))}),e}function a(n,e){e=o.isArray(e)?e:[e];var t=!1;return o.isArray(n)?o.each(n,function(n){o.indexOf(e,n)>-1&&(t=!0)}):o.indexOf(e,n)>-1&&(t=!0),t}function r(n,e){var t=o.encodeTrackData(e);return n.indexOf("?")!==-1?n+"&"+t:n+"?"+t}var i,o,s,u="_sdk_sdk_version",c={hookFn:null,init:function(n){this.hookFn=n,i.registerInterceptor("sendDataStage",{send:{priority:20,entry:function(n,e){return c.sendData(n,e),n}}})},sendData:function(n,e){var r=n.data,i=r.event,s=n.server_url,u=n.callback,c=this,d=this.hookFn({event_name:i,data:o.extend2Lev({identities:{},lib:{},properties:{}},r),server_url:s});return o.isArray(d)&&d.length?(d=t(d),a(s,d)?u=null:e.cancellationToken.stop(),o.each(d,function(e){if(e&&""!==e&&!a(e,s)){var t=function(e){return function(){c.sendCall({server_url:e,data:n.data,config:null,callback:u}),u=null,n.callback=null}}(e);setTimeout(t)}}),n):(o.isFunction(u)&&u(),e.cancellationToken.stop(),n)},getInstance:function(n){return"beacon"===i.para.send_type&&o.isSupportBeaconSend()?(n.data=o.encodeTrackData(n.data),new o.BeaconSend(n)):"ajax"===i.para.send_type&&o.isSupportCors()?(n.data=o.encodeTrackData(n.data),new o.AjaxSend(n)):(n.data.time=1*new Date,n.data=r(n.server_url,n.data),new o.ImageSend(n))},sendCall:function(n){var e=this.getInstance(n);e.start()}},d={plugin_name:"CustomEventsSender",init:function(n,e){if(i=n,o=i._,s=i&&i.log||console&&console.log||function(){},o.isFunction(e)){if(i.readyState&&i.readyState.state>=3||!i.on)return c.init(e);i.on("sdkAfterInitPara",function(){c.init(e)})}else s("CustomEventsSender init failed\uff0chookFn error. hookFn:",e)}},l=e(d);return l}();