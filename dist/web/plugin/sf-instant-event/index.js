(window.SensorsDataWebJSSDKPlugin=window.SensorsDataWebJSSDKPlugin||{}).SfInstantEvent=function(){"use strict";function e(e,t,n){if(t&&(e.plugin_name=t),n&&e.init){var a=e.init;e.init=function(t,r){function i(){a.call(e,t,r)}return t.readyState&&t.readyState.state>=3||!t.on?i():void t.on(n,i)}}return e}function t(t,n,a){return e(t,n,a),t.plugin_version=c,t}function n(e,t){var n=o.kit.encodeTrackData(t);return e.indexOf("?")!==-1?e+"&"+n:e+"?"+n}function a(e){if("beacon"===o.para.send_type&&u.isSupportBeaconSend())return e.data=o.kit.encodeTrackData(e.data)+"&instant_event=true",new u.BeaconSend(e);if("ajax"===o.para.send_type&&u.isSupportCors())return e.data=o.kit.encodeTrackData(e.data)+"&instant_event=true",new u.BeaconSend(e);var t=n(e.server_url,e.data),a=u.getQueryParam(t,"ext"),r=u.urlParse(t);return r.addQueryString({ext:a+"%2Cinstant_evnet%3Dtrue"}),e.data=r.getUrl(),new u.ImageSend(e)}function r(e){var t=a(e);t.start()}function i(e,t){var n=e.data.event,a=e.data.type;if(!n||u.indexOf(d,n)===-1)return e;var i=o.para.app_js_bridge&&o.bridge&&o.bridge.bridge_info&&"success"===o.bridge.bridge_info.verify_success,s="item_set"===a||"item_delete"===a,c=o.para.app_js_bridge.is_mui===!0;if(i&&!s&&!c)return e.data.is_instant_event=!0,e;t.cancellationToken.stop();var f=e.server_url;return u.isArray(f)&&f.length?void u.each(f,function(t){e.callback=null,e.server_url=t,r(e)}):(r(e),e)}function s(){o.registerInterceptor("sendDataStage",{send:{priority:50,entry:i}})}var o,u,d,c="_sdk_sdk_version",f={plugin_name:"SfInstantEvent",init:function(e,t){if(o=e,u=o._,u.isObject(t)&&u.isArray(t.instant_events)){if(d=t.instant_events,o.readyState&&o.readyState.state>=3||!o.on)return s();o.on("sdkAfterInitPara",function(){s()})}else o.log("SfInstantEvent init failed\uff0cparameter error. option:",t)}},_=t(f);return _}();