function wrapPluginInitFn(t,e,s){var i=t.init;return e&&(t.name=e),t.init=function(e,o){if(e.readyState&&e.readyState.state>=3||!e.on)return r();function r(){i.call(t,e,o)}e.on(s,r)},t}function addProperties(t,e){if("track"!==t.type)return t;var s=e.sd,i=s._,o=s.saEvent.check,r=i.extend2Lev({properties:{}},t),n=e.currentProps,p=r.properties,a=r.event,h={};return i.each(n,function(t){if(i.isObject(t))i.indexOf(t.events,a)>-1&&o({properties:t.properties})&&(h=i.extend(h,t.properties));else if(i.isFunction(t)){var e=t({event:a,properties:p,data:r});i.isObject(e)&&!i.isEmptyObject(e)&&o({properties:e})&&(h=i.extend(h,e))}}),t.properties=i.extend(p,h),t}function DataStageImpl(t){var e=this;this.sd=t.sd,this.currentProps=t.customRegister,this.interceptor={addCustomProps:{priority:0,entry:function(t){return addProperties(t,e),t}}}}function registerPropertiesFeature(t){this.dataStage=new DataStageImpl(t)}function RegisterProperties(){this.sd=null,this.log=window.console&&window.console.log||function(){},this.customRegister=[]}function Store(t){this.sd=t,this._=t._,this.cookie_value=null}DataStageImpl.prototype.init=function(){},RegisterProperties.prototype.init=function(t){t?(this.sd=t,this._=t._,this.log=t.log,t.registerFeature(new registerPropertiesFeature(this))):this.log("\u795e\u7b56JS SDK\u672a\u6210\u529f\u5f15\u5165")},RegisterProperties.prototype.register=function(t){this.sd?this._.isObject(t)&&this._.isArray(t.events)&&t.events.length>0&&this._.isObject(t.properties)&&!this._.isEmptyObject(t.properties)?this.customRegister.push(t):this.log("RegisterProperties: register \u53c2\u6570\u9519\u8bef"):this.log("\u795e\u7b56JS SDK\u672a\u6210\u529f\u5f15\u5165")},RegisterProperties.prototype.hookRegister=function(t){this.sd?this._.isFunction(t)?this.customRegister.push(t):this.log("RegisterProperties: hookRegister \u53c2\u6570\u9519\u8bef"):this.log("\u795e\u7b56JS SDK\u672a\u6210\u529f\u5f15\u5165")},Store.prototype.saveObjectVal=function(t,e){this._.isString(e)||(e=JSON.stringify(e)),1==this.sd.para.encrypt_cookie&&(e=this._.encrypt(e)),this._.cookie.isSupport()&&this._.cookie.set(t,e),this.cookie_value=e},Store.prototype.readObjectVal=function(t){var e=this._.cookie.isSupport()?this._.cookie.get(t):this.cookie_value;return e?(e=this._.decryptIfNeeded(e),this._.safeJSONParse(e)):null};var COOKIE_NAME="sensorsdata2015jssdksession";function SessionEvent(){this.registerProperties=null,this.store=null,this.sd=null,this._=null,this.log=window.console&&window.console.log||function(){},this.cookie_name="",this.prop={}}SessionEvent.prototype.init=function(t){if(t&&"object"==typeof t){var e=this;this.sd=t,this._=t._,this.log=t.log,this.cookie_name=COOKIE_NAME+(t.para.sdk_id||""),this.registerProperties=new RegisterProperties,this.registerProperties.init(t),this.store=new Store(t),this.registerProperties.hookRegister(function(){return e.addSessionID()})}else this.log("Session Event \u63d2\u4ef6\u521d\u59cb\u5316\u5931\u8d25\uff01")},SessionEvent.prototype.addSessionID=function(){var t=+new Date;this.prop=this.store.readObjectVal(this.cookie_name)||{};var e=this.prop.first_session_time,s=this.prop.latest_session_time;if(!e||!s||e>t||s>t||t-e>432e5||t-s>18e5){var i=this._.UUID();this.prop={session_id:i.replace(/-/g,""),first_session_time:t,latest_session_time:t}}else this.prop.latest_session_time=t;return this.store.saveObjectVal(this.cookie_name,this.prop),{$event_session_id:this.prop.session_id}};var instance=new SessionEvent;wrapPluginInitFn(instance,"SessionEvent","sdkReady");export default instance;