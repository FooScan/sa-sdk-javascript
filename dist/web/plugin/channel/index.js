(window.SensorsDataWebJSSDKPlugin=window.SensorsDataWebJSSDKPlugin||{}).SensorsChannel=function(){"use strict";function e(e,n,t){var i=e.init;return n&&(e.name=n),e.init=function(n,a){function r(){i.call(e,n,a)}return n.readyState&&n.readyState.state>=3||!n.on?r():void n.on(t,r)},e}var n,t,i,a,r={event_list:[],latest_event_initial_time:null,max_save_time:2592e6,init:function(e,r){function s(){return n=t._,i=t.store,!!n.localStorage.isSupport()&&(t.para.max_string_length=1024,l.eventList.init(),l.addLatestChannelUrl(),void l.addIsChannelCallbackEvent())}if(t||!e)return!1;r=r||{},a=r.cookie_name||"sensorsdata2015jssdkchannel",t=e;var l=this;s()},addIsChannelCallbackEvent:function(){t.registerPage({$is_channel_callback_event:function(e){if(n.isObject(e)&&e.event&&"$WebClick"!==e.event&&"$pageview"!==e.event&&"$WebStay"!==e.event&&"$SignUp"!==e.event)return!r.eventList.hasEvent(e.event)&&(r.eventList.add(e.event),!0)}})},addLatestChannelUrl:function(){var e=this.getUrlDomain(),i=this.cookie.getChannel();if("url\u89e3\u6790\u5931\u8d25"===e)this.registerAndSave({_sa_channel_landing_url:"",_sa_channel_landing_url_error:"url\u7684domain\u89e3\u6790\u5931\u8d25"});else if(n.isReferralTraffic(document.referrer)){var a=n.getQueryParam(location.href,"sat_cf");n.isString(a)&&a.length>0?(this.registerAndSave({_sa_channel_landing_url:location.href}),r.channelLinkHandler()):this.registerAndSave({_sa_channel_landing_url:""})}else i?t.registerPage(i):t.registerPage({_sa_channel_landing_url:"",_sa_channel_landing_url_error:"\u53d6\u503c\u5f02\u5e38"})},registerAndSave:function(e){t.registerPage(e),this.cookie.saveChannel(e)},cookie:{getChannel:function(){var e=n.decryptIfNeeded(n.cookie.get(a));return e=n.safeJSONParse(e),!(!n.isObject(e)||!e.prop)&&e.prop},saveChannel:function(e){var i={prop:e},r=JSON.stringify(i);t.para.encrypt_cookie&&(r=n.encrypt(r)),n.cookie.set(a,r)}},channelLinkHandler:function(){this.eventList.reset(),t.track("$ChannelLinkReaching")},getUrlDomain:function(){var e=n.info.pageProp.url_domain;return""===e&&(e="url\u89e3\u6790\u5931\u8d25"),e},eventList:{init:function(){var e=this.get(),t=(new Date).getTime();if(e&&n.isNumber(e.latest_event_initial_time)&&n.isArray(e.eventList)){var i=t-e.latest_event_initial_time;i>0&&i<r.max_save_time?(r.event_list=e.eventList,r.latest_event_initial_time=e.latest_event_initial_time):this.reset()}else this.reset()},get:function(){var e={};try{e=i.readObjectVal("sawebjssdkchannel")}catch(n){t.log(n)}return e},add:function(e){r.event_list.push(e),this.save()},save:function(){var e={latest_event_initial_time:r.latest_event_initial_time,eventList:r.event_list};i.saveObjectVal("sawebjssdkchannel",e)},reset:function(){r.event_list=[],r.latest_event_initial_time=(new Date).getTime(),this.save()},hasEvent:function(e){var t=!1;return n.each(r.event_list,function(n){n===e&&(t=!0)}),t}}};return e(r,"SensorsChannel","sdkAfterInitPara"),r}();